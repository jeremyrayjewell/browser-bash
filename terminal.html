<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline'; connect-src 'self' https://api.allorigins.win https://cors-anywhere.herokuapp.com https://thingproxy.freeboard.io data: blob:; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';">
    <title>Aggregatron Terminal</title>
    <style>
        body {
            margin: 0;
            padding: 10px;
            background: #1e1e1e;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            line-height: 1.4;
            height: 100vh;
            overflow: hidden;
        }

        .terminal-container {
            max-width: 1200px;
            height: calc(100vh - 20px);
            margin: 0 auto;
            background: #1e1e1e;
            border: 2px solid #00ff00;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
            display: flex;
            flex-direction: column;
        }

        .terminal-header {
            background: #2d2d2d;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #333;
        }

        .terminal-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .close { background: #ff5f56; }
        .minimize { background: #ffbd2e; }
        .maximize { background: #27ca3f; }

        .terminal-title {
            color: #ccc;
            font-size: 14px;
            margin-left: 10px;
        }

        .terminal-content {
            padding: 20px;
            flex: 1;
            background: #1e1e1e;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .output {
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            color: #ffffff;
            flex: 1;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .input-line {
            display: flex;
            align-items: center;
            flex-shrink: 0;
            margin-top: 10px;
        }

        .prompt {
            color: #00ff00;
            margin-right: 8px;
        }

        input[type="text"] {
            background: transparent;
            border: none;
            color: #ffffff;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            outline: none;
            flex: 1;
        }

        /* ANSI Color Support */
        .ansi-red { color: #ff4444; }
        .ansi-green { color: #44ff44; }
        .ansi-yellow { color: #ffff44; }
        .ansi-blue { color: #4444ff; }
        .ansi-magenta { color: #ff44ff; }
        .ansi-cyan { color: #44ffff; }
        .ansi-white { color: #ffffff; }
        .ansi-bright-red { color: #ff6666; }
        .ansi-bright-green { color: #66ff66; }
        .ansi-bright-yellow { color: #ffff66; }
        .ansi-bright-blue { color: #6666ff; }
        .ansi-bright-magenta { color: #ff66ff; }
        .ansi-bright-cyan { color: #66ffff; }
        .ansi-bright-white { color: #ffffff; }

        /* Custom Scrollbar */
        .output::-webkit-scrollbar {
            width: 12px;
        }

        .output::-webkit-scrollbar-track {
            background: #1e1e1e;
            border-radius: 6px;
            border: 1px solid #333;
        }

        .output::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #00ff00, #00cc00);
            border-radius: 6px;
            border: 1px solid #00aa00;
            box-shadow: inset 0 0 3px rgba(0, 255, 0, 0.3);
        }

        .output::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #22ff22, #00ee00);
            box-shadow: inset 0 0 5px rgba(0, 255, 0, 0.5);
        }

        .output::-webkit-scrollbar-thumb:active {
            background: linear-gradient(180deg, #44ff44, #22dd22);
        }

        .output::-webkit-scrollbar-corner {
            background: #1e1e1e;
        }

        /* Terminal content scrollbar */
        .terminal-content::-webkit-scrollbar {
            width: 12px;
        }

        .terminal-content::-webkit-scrollbar-track {
            background: #2d2d2d;
            border-radius: 6px;
        }

        .terminal-content::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #00ff00, #00cc00);
            border-radius: 6px;
            border: 1px solid #00aa00;
        }

        .terminal-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #22ff22, #00ee00);
        }

        /* Firefox scrollbar */
        .output, .terminal-content {
            scrollbar-width: thin;
            scrollbar-color: #00ff00 #1e1e1e;
        }

        .blink {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .boot-sequence {
            margin: 20px 0;
        }

        .system-info {
            color: #888;
            font-size: 12px;
            padding: 10px;
            border: 1px solid #333;
            border-radius: 4px;
            background: #2a2a2a;
            flex-shrink: 0;
            margin-top: 10px;
        }

        /* Mobile responsive styles */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 12px;
            }
            
            .terminal-container {
                max-width: 100%;
                border-radius: 4px;
            }
            
            .terminal-content {
                padding: 10px;
                height: 70vh;
                font-size: 10px;
            }
            
            .output {
                font-size: 10px;
                line-height: 1.2;
            }
            
            input[type="text"] {
                font-size: 12px;
            }
            
            .terminal-title {
                font-size: 12px;
            }
            
            .system-info {
                font-size: 10px;
                padding: 8px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
                font-size: 10px;
            }
            
            .terminal-content {
                padding: 8px;
                height: 75vh;
                font-size: 8px;
            }
            
            .output {
                font-size: 8px;
                line-height: 1.1;
            }
            
            input[type="text"] {
                font-size: 10px;
            }
            
            .terminal-header {
                padding: 8px 10px;
            }
            
            .terminal-button {
                width: 10px;
                height: 10px;
            }
            
            .terminal-title {
                font-size: 10px;
            }
            
            .system-info {
                font-size: 9px;
                padding: 6px;
            }
            
            .prompt {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="terminal-container">
        <div class="terminal-header">
            <div class="terminal-button close"></div>
            <div class="terminal-button minimize"></div>
            <div class="terminal-button maximize"></div>
            <div class="terminal-title">Aggregatron Web Terminal v1.0</div>
        </div>
        <div class="terminal-content">
            <div class="output" id="output"></div>
            <div class="input-line">
                <span class="prompt">aggregatron@terminal:~$ </span>
                <input type="text" id="commandInput" placeholder="Type 'help' to get started" autocomplete="off">
            </div>
            <div class="system-info">
                <strong>System Info:</strong> Aggregatron Web Terminal Emulator 
            </div>
        </div>
    </div>

    <script>
        const output = document.getElementById('output');
        const commandInput = document.getElementById('commandInput');
        
        let currentDir = window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/')) || '/';
        let commandHistory = [];
        let historyIndex = -1;

        // ASCII Art database
        const asciiArt = {
            logo: `<div style="text-align: center; font-size: clamp(6px, 2vw, 14px); overflow-x: auto;">
<span class="ansi-magenta">                     ┏━┓┏━╸┏━╸┏━┓┏━╸┏━╸┏━┓╺┳╸┏━┓┏━┓┏┓╻</span>
<span class="ansi-cyan">                     ┣━┫┃╺┓┃╺┓┣┳┛┣╸ ┃╺┓┣━┫ ┃ ┣┳┛┃ ┃┃┗┫</span>
<span class="ansi-yellow">                     ╹ ╹┗━┛┗━┛╹┗╸┗━╸┗━┛╹ ╹ ╹ ╹┗╸┗━┛╹ ╹</span>

<span class="ansi-green">        ████████╗███████╗██████╗ ███╗   ███╗██╗███╗   ██╗ █████╗ ██╗</span>     
<span class="ansi-blue">        ╚══██╔══╝██╔════╝██╔══██╗████╗ ████║██║████╗  ██║██╔══██╗██║</span>     
<span class="ansi-red">           ██║   █████╗  ██████╔╝██╔████╔██║██║██╔██╗ ██║███████║██║</span>     
<span class="ansi-yellow">           ██║   ██╔══╝  ██╔══██╗██║╚██╔╝██║██║██║╚██╗██║██╔══██║██║</span>     
<span class="ansi-magenta">           ██║   ███████╗██║  ██║██║ ╚═╝ ██║██║██║ ╚████║██║  ██║███████╗</span>
<span class="ansi-cyan">           ╚═╝   ╚══════╝╚═╝  ╚═╝╚═╝     ╚═╝╚═╝╚═╝  ╚═══╝╚═╝  ╚═╝╚══════╝</span>

        <span class="ansi-red">▄▄▄</span><span class="ansi-yellow">▄▄▄</span><span class="ansi-green">▄▄▄</span><span class="ansi-blue">▄▄▄</span><span class="ansi-magenta">▄▄▄</span><span class="ansi-cyan">▄▄▄</span><span class="ansi-red">▄▄▄</span><span class="ansi-yellow">▄▄▄</span><span class="ansi-green">▄▄▄</span><span class="ansi-blue">▄▄▄</span><span class="ansi-magenta">▄▄▄</span><span class="ansi-cyan">▄▄▄</span><span class="ansi-red">▄▄▄</span><span class="ansi-yellow">▄▄▄</span><span class="ansi-green">▄▄▄</span><span class="ansi-blue">▄▄▄</span><span class="ansi-magenta">▄▄▄</span><span class="ansi-cyan">▄▄▄</span><span class="ansi-red">▄▄▄</span><span class="ansi-yellow">▄▄▄</span><span class="ansi-green">▄▄▄</span><span class="ansi-blue">▄▄▄</span>
        <span class="ansi-red">█▀█</span><span class="ansi-yellow">█▀█</span><span class="ansi-green">█▀█</span><span class="ansi-blue">█▀█</span><span class="ansi-magenta">█▀█</span><span class="ansi-cyan">█▀█</span><span class="ansi-red">█▀█</span><span class="ansi-yellow">█▀█</span><span class="ansi-green">█▀█</span><span class="ansi-blue">█▀█</span><span class="ansi-magenta">█▀█</span><span class="ansi-cyan">█▀█</span><span class="ansi-red">█▀█</span><span class="ansi-yellow">█▀█</span><span class="ansi-green">█▀█</span><span class="ansi-blue">█▀█</span><span class="ansi-magenta">█▀█</span><span class="ansi-cyan">█▀█</span><span class="ansi-red">█▀█</span><span class="ansi-yellow">█▀█</span><span class="ansi-green">█▀█</span><span class="ansi-blue">█▀█</span>
        <span class="ansi-red">█ █</span><span class="ansi-yellow">█ █</span><span class="ansi-green">█ █</span><span class="ansi-blue">█ █</span><span class="ansi-magenta">█ █</span><span class="ansi-cyan">█ █</span><span class="ansi-red">█ █</span><span class="ansi-yellow">█ █</span><span class="ansi-green">█ █</span><span class="ansi-blue">█ █</span><span class="ansi-magenta">█ █</span><span class="ansi-cyan">█ █</span><span class="ansi-red">█ █</span><span class="ansi-yellow">█ █</span><span class="ansi-green">█ █</span><span class="ansi-blue">█ █</span><span class="ansi-magenta">█ █</span><span class="ansi-cyan">█ █</span><span class="ansi-red">█ █</span><span class="ansi-yellow">█ █</span><span class="ansi-green">█ █</span><span class="ansi-blue">█ █</span>
        <span class="ansi-red">▀▀▀</span><span class="ansi-yellow">▀▀▀</span><span class="ansi-green">▀▀▀</span><span class="ansi-blue">▀▀▀</span><span class="ansi-magenta">▀▀▀</span><span class="ansi-cyan">▀▀▀</span><span class="ansi-red">▀▀▀</span><span class="ansi-yellow">▀▀▀</span><span class="ansi-green">▀▀▀</span><span class="ansi-blue">▀▀▀</span><span class="ansi-magenta">▀▀▀</span><span class="ansi-cyan">▀▀▀</span><span class="ansi-red">▀▀▀</span><span class="ansi-yellow">▀▀▀</span><span class="ansi-green">▀▀▀</span><span class="ansi-blue">▀▀▀</span><span class="ansi-magenta">▀▀▀</span><span class="ansi-cyan">▀▀▀</span><span class="ansi-red">▀▀▀</span><span class="ansi-yellow">▀▀▀</span><span class="ansi-green">▀▀▀</span><span class="ansi-blue">▀▀▀</span>

<span class="ansi-bright-cyan">                Welcome to Aggregatron Web Terminal Interface v1.0</span>
</div>`
        };
        const commands = {
            help: function() {
                return `<span class="ansi-green">Available Commands:</span>

<span class="ansi-magenta">🌐 Network Commands:</span>
• <span class="ansi-yellow">curl [options] URL</span> - Transfer data from servers (real HTTP requests!)
• <span class="ansi-yellow">wget URL</span> - Download files from web
• <span class="ansi-yellow">ping HOST</span> - Send ICMP packets to host

<span class="ansi-magenta">🗂️ File System:</span>
• <span class="ansi-yellow">ls</span> - List files
• <span class="ansi-yellow">cat [file]</span> - Display file contents
• <span class="ansi-yellow">pwd</span> - Show current directory

<span class="ansi-magenta">💻 System:</span>
• <span class="ansi-yellow">uname [-a]</span> - System information
• <span class="ansi-yellow">date</span> - Show current date
• <span class="ansi-yellow">clear</span> - Clear terminal
• <span class="ansi-yellow">exit</span> - Close terminal

<span class="ansi-cyan">🚀 This terminal uses REAL curl via CORS proxy! Try:</span>
<span class="ansi-white">curl https://httpbin.org/json</span>
<span class="ansi-white">curl https://api.github.com/zen</span>
<span class="ansi-white">curl -I https://jsonplaceholder.typicode.com/posts/1</span>
<span class="ansi-yellow">Note:</span> <span class="ansi-white">Makes real HTTP requests via CORS proxy - no simulation</span>`;
            },

            ls: async function(args) {
                // Try to fetch the actual directory listing from the server
                try {
                    // For same-origin requests, we can try to get directory listing
                    const currentPath = window.location.pathname;
                    const basePath = currentPath.substring(0, currentPath.lastIndexOf('/') + 1);
                    
                    // Try to fetch directory index or use GitHub API for repository contents
                    const repoOwner = 'jeremyrayjewell';
                    const repoName = 'browser-bash';
                    const githubApiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents`;
                    
                    const corsProxies = [
                        `https://api.allorigins.win/get?url=${encodeURIComponent(githubApiUrl)}`,
                        `https://cors-anywhere.herokuapp.com/${githubApiUrl}`
                    ];
                    
                    for (const proxyUrl of corsProxies) {
                        try {
                            const response = await fetch(proxyUrl);
                            if (response.ok) {
                                const data = await response.json();
                                
                                // Handle allorigins.win response format
                                const contents = data.contents ? JSON.parse(data.contents) : data;
                                
                                if (Array.isArray(contents)) {
                                    let output = '';
                                    contents.forEach(item => {
                                        const color = item.type === 'dir' ? 'ansi-blue' : 'ansi-green';
                                        const suffix = item.type === 'dir' ? '/' : '';
                                        output += `<span class="${color}">${item.name}${suffix}</span>  `;
                                    });
                                    return output || '<span class="ansi-yellow">Empty directory</span>';
                                }
                            }
                        } catch (error) {
                            console.log(`GitHub API proxy ${proxyUrl} failed:`, error);
                            continue;
                        }
                    }
                    
                    // If GitHub API fails, try to detect files by attempting to fetch known files
                    const knownFiles = ['terminal.html', 'README.md', 'index.txt', 'jrj', 'lucre', 'software', 'links'];
                    const existingFiles = [];
                    
                    for (const file of knownFiles) {
                        try {
                            const response = await fetch(file, { method: 'HEAD' });
                            if (response.ok) {
                                existingFiles.push(file);
                            }
                        } catch (error) {
                            // File doesn't exist or can't access it
                        }
                    }
                    
                    if (existingFiles.length > 0) {
                        let output = '';
                        existingFiles.forEach(file => {
                            const color = file.endsWith('.html') ? 'ansi-cyan' : 
                                        file.endsWith('.md') ? 'ansi-yellow' : 'ansi-green';
                            output += `<span class="${color}">${file}</span>  `;
                        });
                        return output + `\n<span class="ansi-yellow">Note: Detected ${existingFiles.length} accessible files</span>`;
                    }
                    
                    // Final fallback - show error message
                    return '<span class="ansi-red">ls: cannot access directory: Permission denied</span>\n<span class="ansi-yellow">Note: Browser security prevents real directory listing</span>';
                    
                } catch (error) {
                    return `<span class="ansi-red">ls: error reading directory: ${error.message}</span>`;
                }
            },

            cat: async function(args) {
                if (!args.length) {
                    return '<span class="ansi-red">cat: missing file operand</span>';
                }
                
                const filename = args[0];
                
                try {
                    // Try to fetch the actual file
                    const response = await fetch(filename);
                    
                    if (response.ok) {
                        const content = await response.text();
                        return `<span class="ansi-white">${content}</span>`;
                    } else if (response.status === 404) {
                        return `<span class="ansi-red">cat: ${filename}: No such file or directory</span>`;
                    } else {
                        return `<span class="ansi-red">cat: ${filename}: Permission denied</span>`;
                    }
                } catch (error) {
                    return `<span class="ansi-red">cat: ${filename}: ${error.message}</span>`;
                }
            },

            pwd: function() {
                return window.location.href;
            },

            uname: function(args) {
                if (args.includes('-a')) {
                    return 'Browser-Linux 1.0.0 #1 SMP Web Browser x86_64 GNU/Linux';
                }
                return 'Browser-Linux';
            },

            date: function() {
                return new Date().toString();
            },

            clear: function() {
                output.innerHTML = '';
                return '';
            },

            curl: async function(args) {
                if (!args.length) {
                    return '<span class="ansi-red">curl: try \'curl --help\' for more information</span>';
                }

                const url = args[args.length - 1]; // Last argument is typically the URL
                
                // Handle help
                if (args.includes('--help') || args.includes('-h')) {
                    return `<span class="ansi-green">curl - transfer data from or to a server</span>

<span class="ansi-yellow">Usage:</span> curl [options] URL

<span class="ansi-yellow">Options:</span>
  -I, --head     Show document info only (headers)
  -L, --location Follow redirects
  -s, --silent   Silent mode
  -v, --verbose  Verbose output
  --help         This help text

<span class="ansi-cyan">Examples:</span>
  curl https://httpbin.org/json
  curl https://api.github.com/user
  curl https://jsonplaceholder.typicode.com/posts/1
  curl -I https://example.com

<span class="ansi-yellow">Note:</span> Makes real HTTP requests via CORS proxy.
If the proxy fails, curl will return proper error codes like the real tool.`;
                }

                // Check if this is a local/same-origin request or if we should simulate
                const isLocalhost = url.includes('localhost') || url.includes('127.0.0.1');
                const currentHost = window.location.host;
                const isSameOrigin = url.includes(currentHost);
                
                // Show loading message
                const loadingMsg = `<span class="ansi-yellow">Fetching ${url}...</span>`;
                appendOutput(loadingMsg);
                
                // Remove loading message after a brief delay
                setTimeout(() => {
                    const outputElements = output.children;
                    for (let i = outputElements.length - 1; i >= 0; i--) {
                        if (outputElements[i].innerHTML.includes('Fetching')) {
                            outputElements[i].remove();
                            break;
                        }
                    }
                }, 800);
                
                // If it's a localhost or same-origin request, try real fetch
                if (isLocalhost || isSameOrigin) {
                    try {
                        const isHeadRequest = args.includes('-I') || args.includes('--head');
                        const isVerbose = args.includes('-v') || args.includes('--verbose');
                        
                        const options = {
                            method: isHeadRequest ? 'HEAD' : 'GET',
                            mode: 'same-origin'
                        };

                        const response = await fetch(url, options);
                        
                        let result = '';
                        if (isHeadRequest || isVerbose) {
                            result += `<span class="ansi-green">HTTP/${response.status} ${response.statusText}</span>\n`;
                            response.headers.forEach((value, key) => {
                                result += `<span class="ansi-cyan">${key}:</span> ${value}\n`;
                            });
                            if (isHeadRequest) return result;
                            result += '\n';
                        }

                        if (!isHeadRequest) {
                            const text = await response.text();
                            result += `<span class="ansi-white">${text}</span>`;
                        }
                        
                        return result;
                    } catch (error) {
                        return `<span class="ansi-red">curl: (7) Couldn't connect to server</span>\n<span class="ansi-yellow">${error.message}</span>`;
                    }
                }
                
                // For external URLs, try CORS proxy - NO SIMULATION FALLBACK
                return new Promise(async (resolve) => {
                    const isHeadRequest = args.includes('-I') || args.includes('--head');
                    
                    // Try multiple CORS proxies in order
                    const corsProxies = [
                        `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
                        `https://cors-anywhere.herokuapp.com/${url}`,
                        `https://thingproxy.freeboard.io/fetch/${url}`
                    ];
                    
                    let lastError;
                    
                    for (const proxyUrl of corsProxies) {
                        try {
                            console.log('Attempting real request via CORS proxy:', proxyUrl);
                            
                            const response = await fetch(proxyUrl, {
                                method: 'GET',
                                mode: 'cors'
                            });
                            
                            if (response.ok) {
                                const text = await response.text();
                                const isJson = text.trim().startsWith('{') || text.trim().startsWith('[');
                                
                                let result = '';
                                if (isHeadRequest) {
                                    const proxyName = proxyUrl.includes('allorigins') ? 'allorigins.win' : 
                                                    proxyUrl.includes('cors-anywhere') ? 'cors-anywhere' : 'thingproxy';
                                    result = `<span class="ansi-green">HTTP/1.1 ${response.status} ${response.statusText}</span>
<span class="ansi-cyan">content-type:</span> ${isJson ? 'application/json' : 'text/plain'}
<span class="ansi-cyan">content-length:</span> ${text.length}
<span class="ansi-cyan">via:</span> CORS Proxy (${proxyName})`;
                                } else {
                                    if (isJson) {
                                        try {
                                            const jsonData = JSON.parse(text);
                                            result = `<span class="ansi-white">${JSON.stringify(jsonData, null, 2)}</span>`;
                                        } catch (e) {
                                            result = `<span class="ansi-white">${text}</span>`;
                                        }
                                    } else {
                                        const maxLength = 2000;
                                        const displayText = text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
                                        result = `<span class="ansi-white">${displayText}</span>`;
                                    }
                                }
                                resolve(result);
                                return;
                            } else {
                                // Try next proxy on error status
                                lastError = new Error(`Proxy returned ${response.status}: ${response.statusText}`);
                                continue;
                            }
                        } catch (error) {
                            // Try next proxy on error
                            lastError = error;
                            console.log(`CORS proxy ${proxyUrl} failed:`, error);
                            continue;
                        }
                    }
                    
                    // All proxies failed - return appropriate error
                    console.log('All CORS proxies failed:', lastError);
                    
                    if (lastError && lastError.message.includes('CSP')) {
                        resolve(`<span class="ansi-red">curl: (35) SSL connect error</span>\n<span class="ansi-yellow">Content Security Policy blocks external connections</span>`);
                    } else if (lastError && lastError.name === 'TypeError' && lastError.message.includes('Failed to fetch')) {
                        resolve(`<span class="ansi-red">curl: (6) Could not resolve host: ${url.split('/')[2]}</span>`);
                    } else {
                        resolve(`<span class="ansi-red">curl: (7) Failed to connect to ${url.split('/')[2]} port 443: Connection refused</span>`);
                    }
                });
            },



            wget: async function(args) {
                if (!args.length) {
                    return '<span class="ansi-red">wget: missing URL</span>\n<span class="ansi-cyan">Usage: wget URL</span>';
                }

                const url = args[0];
                appendOutput(`<span class="ansi-yellow">Connecting to ${url}...</span>`);

                try {
                    const response = await fetch(url);
                    
                    // Remove connecting message
                    const outputElements = output.children;
                    for (let i = outputElements.length - 1; i >= 0; i--) {
                        if (outputElements[i].innerHTML.includes('Connecting')) {
                            outputElements[i].remove();
                            break;
                        }
                    }

                    const filename = url.split('/').pop() || 'index.html';
                    const size = response.headers.get('content-length') || 'unknown';
                    
                    return `<span class="ansi-green">200 OK</span>
Length: ${size} bytes
Saving to: '${filename}'

<span class="ansi-cyan">${filename}</span> <span class="ansi-green">saved</span> [${size}]

<span class="ansi-yellow">Note: File saved to simulated filesystem (not actual download)</span>`;

                } catch (error) {
                    // Remove connecting message
                    const outputElements = output.children;
                    for (let i = outputElements.length - 1; i >= 0; i--) {
                        if (outputElements[i].innerHTML.includes('Connecting')) {
                            outputElements[i].remove();
                            break;
                        }
                    }
                    return `<span class="ansi-red">wget: unable to resolve host address '${url.split('/')[2] || url}'</span>`;
                }
            },

            ping: function(args) {
                if (!args.length) {
                    return '<span class="ansi-red">ping: usage error: Destination address required</span>';
                }

                const host = args[0];
                return `<span class="ansi-white">PING ${host}: 56 data bytes</span>
<span class="ansi-green">64 bytes from ${host}: icmp_seq=0 time=12.345 ms</span>
<span class="ansi-green">64 bytes from ${host}: icmp_seq=1 time=8.123 ms</span>
<span class="ansi-green">64 bytes from ${host}: icmp_seq=2 time=15.678 ms</span>

<span class="ansi-yellow">--- ${host} ping statistics ---</span>
<span class="ansi-white">3 packets transmitted, 3 packets received, 0.0% packet loss</span>
<span class="ansi-white">round-trip min/avg/max/stddev = 8.123/12.049/15.678/3.089 ms</span>

<span class="ansi-cyan">Note: Simulated ping results (browser security doesn't allow real ping)</span>`;
            },

            test: async function(args) {
                if (!args.length) {
                    return '<span class="ansi-yellow">test: Testing basic fetch functionality...</span>\n<span class="ansi-cyan">Usage: test URL</span>';
                }
                
                const testUrl = args[0];
                appendOutput(`<span class="ansi-cyan">Testing fetch to: ${testUrl}</span>`);
                
                try {
                    console.log('Starting test fetch...');
                    const response = await fetch(testUrl, { mode: 'cors' });
                    console.log('Test fetch response:', response);
                    
                    return `<span class="ansi-green">✅ Test successful!</span>
<span class="ansi-white">Status: ${response.status} ${response.statusText}</span>
<span class="ansi-white">Type: ${response.headers.get('content-type') || 'unknown'}</span>`;
                } catch (error) {
                    console.error('Test fetch error:', error);
                    return `<span class="ansi-red">❌ Test failed: ${error.message}</span>
<span class="ansi-yellow">Error type: ${error.constructor.name}</span>`;
                }
            },

            exit: function() {
                return '<span class="ansi-yellow">Thanks for using Browser Terminal! 👋</span>';
            }
        };

        function appendOutput(text) {
            if (text) {
                const div = document.createElement('div');
                div.innerHTML = text;
                output.appendChild(div);
                // Ensure the output area scrolls to show the latest content
                setTimeout(() => {
                    output.scrollTop = output.scrollHeight;
                }, 10);
            }
        }

        async function processCommand(input) {
            const trimmedInput = input.trim();
            const parts = trimmedInput.split(' ');
            const command = parts[0].toLowerCase();
            const args = parts.slice(1);

            // Add to history
            if (trimmedInput) {
                commandHistory.unshift(trimmedInput);
                if (commandHistory.length > 50) commandHistory.pop();
            }
            historyIndex = -1;

            // Show command
            appendOutput(`<span class="prompt">aggregatron@terminal:~$ </span>${input}`);

            if (commands[command]) {
                try {
                    const result = await commands[command](args);
                    if (result) {
                        appendOutput(result);
                    }
                } catch (error) {
                    appendOutput(`<span class="ansi-red">Error: ${error.message}</span>`);
                }
            } else if (trimmedInput) {
                appendOutput(`<span class="ansi-red">Command not found: ${command}</span>\nType <span class="ansi-yellow">'help'</span> for available commands.`);
            }
        }

        // Event handlers
        commandInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const command = this.value;
                this.value = '';
                processCommand(command);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (historyIndex < commandHistory.length - 1) {
                    historyIndex++;
                    this.value = commandHistory[historyIndex] || '';
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex > 0) {
                    historyIndex--;
                    this.value = commandHistory[historyIndex] || '';
                } else {
                    historyIndex = -1;
                    this.value = '';
                }
            }
        });

        // Initialize terminal
        function initTerminal() {
            appendOutput(asciiArt.logo);
            appendOutput('');
            appendOutput('<span class="ansi-cyan">Type <span class="ansi-yellow">"help"</span> for available commands or try <span class="ansi-yellow">"curl https://aggregatron-terminal.netlify.app/"</span> here or in your computer\'s terminal to access Aggregatron content</span>');
            appendOutput('');
            commandInput.focus();
        }

        // Initialize terminal when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initTerminal();
        });
    </script>
</body>
</html>